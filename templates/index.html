<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aè‚¡æ•°æ®ç§‘æ™®åŠ©æ‰‹</title>
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", sans-serif;}
        body {background: #f5f7fa; padding: 15px;}
        .container {max-width: 1200px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px;}
        .header {text-align: center; margin-bottom: 20px;}
        .title {font-size: 24px; font-weight: bold; color: #1f2937;}
        .disclaimer {font-size: 12px; color: red; margin-top: 5px;}
        .tabs {display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px;}
        .tab {padding: 10px 18px; background: #e5e7eb; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;}
        .tab.active {background: #4f46e5; color: white;}
        .content {display: none;}
        .content.active {display: block;}
        .stock-list {margin-top: 10px;}
        .stock-item {padding: 12px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;}
        .stock-name {font-size: 16px; color: #1f2937;}
        .stock-code {font-size: 14px; color: #6b7280; margin-left: 8px;}
        .stock-price {font-size: 16px;}
        .rise {color: #ef4444;}
        .fall {color: #10b981;}
        .chat-area {margin-top: 20px;}
        .chat-history {height: 400px; border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; overflow-y: auto; margin-bottom: 10px;}
        .chat-msg {margin: 10px 0; padding: 10px 15px; border-radius: 8px; max-width: 85%;}
        .user-msg {background: #4f46e5; color: white; margin-left: auto;}
        .ai-msg {background: #f3f4f6; color: #1f2937;}
        .chat-input {display: flex; gap: 10px;}
        #question {flex: 1; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 16px;}
        #send-btn {padding: 12px 20px; background: #4f46e5; color: white; border: none; border-radius: 8px; cursor: pointer;}
        @media (max-width: 768px) {
            .container {padding: 10px;}
            .title {font-size: 20px;}
            .tab {padding: 8px 14px; font-size: 14px;}
            .chat-history {height: 300px;}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">Aè‚¡æ•°æ®ç§‘æ™®åŠ©æ‰‹</div>
            <div class="disclaimer">âš ï¸ æœ¬ç½‘ç«™ä»…ä½œæ•°æ®ç§‘æ™®ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ï¼ŒæŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…</div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('rank')">æ¶¨å¹…æ’è¡Œæ¦œ</button>
            <button class="tab" onclick="switchTab('analysis')">æ¶¨è·Œå¼‚åŠ¨</button>
            <button class="tab" onclick="switchTab('chat')">AIé—®ç­”</button>
        </div>

        <div class="content active" id="rank">
            <h3>ğŸ“ˆ Aè‚¡æ¶¨å¹…æ’è¡Œæ¦œï¼ˆå‰10ï¼‰</h3>
            <div class="stock-list">
                {% for stock in rank %}
                <div class="stock-item">
                    <div class="stock-name">
                        {{ loop.index }}. {{ stock.åç§° }} <span class="stock-code">{{ stock.ä»£ç  }}</span>
                    </div>
                    <div class="stock-price {{ 'rise' if stock.æ¶¨è·Œå¹… > 0 else 'fall' }}">
                        {{ stock.æœ€æ–°ä»· }} ({{ stock.æ¶¨è·Œå¹… }}%)
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="content" id="analysis">
            <h3>ğŸ“Š å°å¹…ä¸Šæ¶¨å¼‚åŠ¨</h3>
            <div class="stock-list">
                {% for stock in analysis.up %}
                <div class="stock-item">
                    <div class="stock-name">{{ stock.åç§° }} <span class="stock-code">{{ stock.ä»£ç  }}</span></div>
                    <div class="stock-price rise">{{ stock.æœ€æ–°ä»· }} ({{ stock.æ¶¨è·Œå¹… }}%)</div>
                </div>
                {% endfor %}
            </div>

            <h3 style="margin-top:20px;">ğŸ“‰ å°å¹…ä¸‹è·Œå¼‚åŠ¨</h3>
            <div class="stock-list">
                {% for stock in analysis.down %}
                <div class="stock-item">
                    <div class="stock-name">{{ stock.åç§° }} <span class="stock-code">{{ stock.ä»£ç  }}</span></div>
                    <div class="stock-price fall">{{ stock.æœ€æ–°ä»· }} ({{ stock.æ¶¨è·Œå¹… }}%)</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="content" id="chat">
            <div class="chat-area">
                <div class="chat-history" id="chat-history"></div>
                <div class="chat-input">
                    <input type="text" id="question" placeholder="è¯·è¾“å…¥Aè‚¡ç›¸å…³é—®é¢˜">
                    <button id="send-btn">å‘é€</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function switchTab(tabId) {
            document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        document.getElementById('send-btn').addEventListener('click', sendMsg);
        document.getElementById('question').addEventListener('keypress', e => {
            if (e.key === 'Enter') sendMsg();
        });

        function sendMsg() {
            const question = document.getElementById('question').value.trim();
            if (!question) return;
            const chatHistory = document.getElementById('chat-history');
            chatHistory.innerHTML += `<div class="chat-msg user-msg">${question}</div>`;
            document.getElementById('question').value = '';

            fetch('/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({question: question})
            }).then(res => res.json())
              .then(data => {
                  chatHistory.innerHTML += `<div class="chat-msg ai-msg">${data.answer}</div>`;
                  chatHistory.scrollTop = chatHistory.scrollHeight;
              }).catch(() => {
                  chatHistory.innerHTML += `<div class="chat-msg ai-msg">ç½‘ç»œé”™è¯¯</div>`;
              });
        }
    </script>
</body>
</html>
